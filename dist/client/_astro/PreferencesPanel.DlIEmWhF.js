import{j as e}from"./jsx-runtime.BG36-YHJ.js";import{r as l}from"./index.y5FlbPQu.js";function T({userId:P}){const[t,i]=l.useState({}),[d,g]=l.useState([]),[j,y]=l.useState(!0),[u,h]=l.useState(!1),[o,c]=l.useState(null),[f,m]=l.useState(null),x=l.useRef(null),p=l.useRef(null);l.useEffect(()=>{N(),k()},[]);const N=async()=>{try{const s=await(await fetch("/api/preferences")).json();i(s.preferences||{})}catch(r){console.error("Failed to load preferences:",r)}finally{y(!1)}},k=async()=>{try{const s=await(await fetch("/api/styles")).json();g(s.categories||[])}catch(r){console.error("Failed to load styles:",r)}},w=async()=>{h(!0),c(null);try{if((await fetch("/api/preferences",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).ok)c({type:"success",text:"Preferences saved!"}),setTimeout(()=>c(null),3e3);else throw new Error("Failed to save")}catch{c({type:"error",text:"Failed to save preferences"})}finally{h(!1)}},b=async(r,s)=>{m(r);try{const a=new FormData;a.append("file",s),a.append("refType",r),a.append("name",s.name.replace(/\.[^/.]+$/,""));const n=await fetch("/api/preferences/upload",{method:"POST",body:a});if(n.ok){const C=await n.json();i(S=>({...S,[r==="character"?"character_ref":"background_ref"]:C.ref})),c({type:"success",text:`${r==="character"?"Character":"Background"} updated!`}),setTimeout(()=>c(null),3e3)}else throw new Error("Upload failed")}catch{c({type:"error",text:"Upload failed"})}finally{m(null)}},_=r=>{for(const s of d){const a=s.styles.find(n=>n.id===r);if(a){i(n=>({...n,style_preset:{id:a.id,name:a.name,category:a.category,description:a.description}}));break}}},v=r=>{i(s=>{const a={...s};return r==="character"?delete a.character_ref:delete a.background_ref,a})};return j?e.jsx("div",{className:"bg-vs-card border border-vs-border rounded-xl p-6",children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"w-8 h-8 border-4 border-violet-500 border-t-transparent rounded-full animate-spin"})})}):e.jsxs("div",{className:"bg-vs-card border border-vs-border rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-medium",children:"Creative Preferences"}),o&&e.jsx("span",{className:`text-sm ${o.type==="success"?"text-green-400":"text-red-400"}`,children:o.text})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/70 mb-3",children:"Character Reference"}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs("div",{className:"w-24 h-24 bg-vs-dark border border-vs-border rounded-lg overflow-hidden flex-shrink-0 cursor-pointer hover:border-violet-500 transition-colors relative group",onClick:()=>x.current?.click(),children:[t.character_ref?.url?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:t.character_ref.url,alt:"Character",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:e.jsx("span",{className:"text-xs",children:"Change"})})]}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-white/40",children:e.jsx("svg",{className:"w-8 h-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})}),f==="character"&&e.jsx("div",{className:"absolute inset-0 bg-black/70 flex items-center justify-center",children:e.jsx("div",{className:"w-6 h-6 border-2 border-violet-500 border-t-transparent rounded-full animate-spin"})})]}),e.jsx("input",{ref:x,type:"file",accept:"image/*",className:"hidden",onChange:r=>{const s=r.target.files?.[0];s&&b("character",s)}}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:t.character_ref?.name||"No character set"}),t.character_ref?.url&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-xs text-white/40 truncate mt-1",children:t.character_ref.url.length>40?"..."+t.character_ref.url.slice(-37):t.character_ref.url}),e.jsx("button",{onClick:()=>v("character"),className:"text-xs text-red-400 hover:text-red-300 mt-2",children:"Remove"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/70 mb-3",children:"Background Reference"}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs("div",{className:"w-32 h-20 bg-vs-dark border border-vs-border rounded-lg overflow-hidden flex-shrink-0 cursor-pointer hover:border-violet-500 transition-colors relative group",onClick:()=>p.current?.click(),children:[t.background_ref?.url?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:t.background_ref.url,alt:"Background",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:e.jsx("span",{className:"text-xs",children:"Change"})})]}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-white/40",children:e.jsx("svg",{className:"w-8 h-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})}),f==="background"&&e.jsx("div",{className:"absolute inset-0 bg-black/70 flex items-center justify-center",children:e.jsx("div",{className:"w-6 h-6 border-2 border-violet-500 border-t-transparent rounded-full animate-spin"})})]}),e.jsx("input",{ref:p,type:"file",accept:"image/*",className:"hidden",onChange:r=>{const s=r.target.files?.[0];s&&b("background",s)}}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:t.background_ref?.name||"No background set"}),t.background_ref?.url&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-xs text-white/40 truncate mt-1",children:t.background_ref.url.length>40?"..."+t.background_ref.url.slice(-37):t.background_ref.url}),e.jsx("button",{onClick:()=>v("background"),className:"text-xs text-red-400 hover:text-red-300 mt-2",children:"Remove"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/70 mb-3",children:"Prompt Style"}),e.jsxs("select",{value:t.style_preset?.id||"",onChange:r=>_(r.target.value),className:"w-full px-4 py-3 bg-vs-dark border border-vs-border rounded-lg text-white focus:border-violet-500 focus:outline-none",children:[e.jsx("option",{value:"",children:"Select a style..."}),d.map(r=>e.jsx("optgroup",{label:r.name,children:r.styles.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))},r.id))]}),t.style_preset&&e.jsxs("div",{className:"mt-3 p-3 bg-vs-dark rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-violet-400",children:t.style_preset.name}),t.style_preset.description&&e.jsx("p",{className:"text-xs text-white/60 mt-1 line-clamp-2",children:t.style_preset.description})]})]}),e.jsxs("div",{className:"pt-4 border-t border-vs-border",children:[e.jsx("button",{onClick:w,disabled:u,className:"w-full px-4 py-3 bg-violet-600 hover:bg-violet-500 disabled:opacity-50 disabled:cursor-not-allowed rounded-lg font-medium transition-colors flex items-center justify-center gap-2",children:u?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Saving..."]}):"Save Preferences"}),e.jsx("p",{className:"text-xs text-white/40 text-center mt-3",children:"These preferences will be automatically applied to all your generations"})]})]})]})}export{T as default};
