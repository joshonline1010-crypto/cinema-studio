import{j as e}from"./jsx-runtime.BG36-YHJ.js";import{r as a}from"./index.y5FlbPQu.js";import{u as U}from"./chatStore.k_UHm0wX.js";import"./index.s7pVKYCa.js";function R(){const{activeProject:o}=U(),[i,p]=a.useState("files"),[u,b]=a.useState([]),[d,k]=a.useState(null),[f,L]=a.useState([]),[j,M]=a.useState([]),[$,c]=a.useState(!1),[w,C]=a.useState(new Set(["outputs","refs","astrix","assets"])),[v,g]=a.useState(!1),[x,n]=a.useState(null);a.useEffect(()=>{o&&(i==="files"?h():y())},[o,i]);const h=async()=>{if(o){c(!0);try{const t=await fetch(`/api/projects/${o.id}/files`);if(t.ok){const r=await t.json();b(r.files||[]),k(r.stats)}}catch(t){console.error("Error fetching files:",t)}finally{c(!1)}}},y=async()=>{if(o){c(!0);try{const t=await fetch(`/api/projects/${o.id}/workflows`);if(t.ok){const r=await t.json();L(r.workflows||[]),M(r.executions||[])}}catch(t){console.error("Error fetching workflows:",t)}finally{c(!1)}}},S=t=>{C(r=>{const s=new Set(r);return s.has(t)?s.delete(t):s.add(t),s})},B=t=>new Date(t).toLocaleString(),F=t=>t?t<1e3?`${t}ms`:t<6e4?`${(t/1e3).toFixed(1)}s`:`${(t/6e4).toFixed(1)}m`:"-",W=t=>{const r=t.split(".").pop()?.toLowerCase();return["png","jpg","jpeg","gif","webp"].includes(r||"")?e.jsx("svg",{className:"w-4 h-4 text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}):["mp4","webm","mov"].includes(r||"")?e.jsx("svg",{className:"w-4 h-4 text-purple-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})}):["mp3","wav","ogg"].includes(r||"")?e.jsx("svg",{className:"w-4 h-4 text-yellow-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})}):r==="json"?e.jsx("svg",{className:"w-4 h-4 text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"})}):e.jsx("svg",{className:"w-4 h-4 text-white/40",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})},N=(t,r=0)=>t.map(s=>e.jsx("div",{children:s.type==="folder"?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>S(s.path),className:"w-full flex items-center gap-2 px-2 py-1.5 hover:bg-white/10 rounded text-left cursor-pointer",style:{paddingLeft:`${r*16+8}px`},children:[e.jsx("svg",{className:`w-3 h-3 text-white/50 transition-transform duration-200 ${w.has(s.path)?"rotate-90":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),e.jsx("svg",{className:`w-4 h-4 ${s.name==="astrix"?"text-violet-400":"text-yellow-500"}`,fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"})}),e.jsx("span",{className:"text-sm text-white/80 flex-1",children:s.name}),e.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded ${s.children&&s.children.length>0?"bg-white/10 text-white/50":"text-white/30"}`,children:s.children?s.children.length:0})]}),w.has(s.path)&&e.jsx("div",{children:s.children&&s.children.length>0?N(s.children,r+1):e.jsx("div",{className:"text-xs text-white/30 italic py-1",style:{paddingLeft:`${r*16+40}px`},children:"(empty)"})})]}):e.jsxs("div",{className:"flex items-center gap-2 px-2 py-1 hover:bg-white/5 rounded group",style:{paddingLeft:`${r*16+24}px`},children:[W(s.name),s.url?e.jsx("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-white/70 hover:text-vs-accent truncate flex-1",title:s.name,children:s.name}):e.jsx("span",{className:"text-sm text-white/50 truncate flex-1",title:s.name,children:s.name}),s.size!==void 0&&e.jsx("span",{className:"text-xs text-white/30",children:E(s.size)})]})},s.path)),E=t=>{if(t===0)return"0 B";const r=1024,s=["B","KB","MB","GB"],l=Math.floor(Math.log(t)/Math.log(r));return parseFloat((t/Math.pow(r,l)).toFixed(1))+" "+s[l]},z=async t=>{const r=t.target.files?.[0];if(!(!r||!o)){g(!0),n(null);try{const s=new FormData;s.append("file",r),s.append("refType","general");const l=await fetch(`/api/projects/${o.id}/upload-ref`,{method:"POST",body:s}),m=await l.json();l.ok&&m.success?(n(`Uploaded: ${m.filename}`),h()):n(`Error: ${m.error||"Upload failed"}`)}catch(s){n(`Error: ${String(s)}`)}finally{g(!1),setTimeout(()=>n(null),3e3),t.target.value=""}}};return o?e.jsxs("div",{className:"h-full flex flex-col bg-vs-card border-l border-vs-border",children:[e.jsxs("div",{className:"p-4 border-b border-vs-border",children:[e.jsx("h2",{className:"text-lg font-medium text-white truncate",title:o.name,children:o.name}),e.jsx("p",{className:"text-xs text-white/40 mt-1 font-mono",children:o.id})]}),e.jsxs("div",{className:"flex border-b border-vs-border",children:[e.jsx("button",{onClick:()=>p("files"),className:`flex-1 px-4 py-2 text-sm font-medium transition-colors ${i==="files"?"text-vs-accent border-b-2 border-vs-accent":"text-white/50 hover:text-white/70"}`,children:"Files"}),e.jsx("button",{onClick:()=>p("workflows"),className:`flex-1 px-4 py-2 text-sm font-medium transition-colors ${i==="workflows"?"text-vs-accent border-b-2 border-vs-accent":"text-white/50 hover:text-white/70"}`,children:"Workflows"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:$?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"w-6 h-6 border-2 border-vs-accent border-t-transparent rounded-full animate-spin"})}):i==="files"?e.jsxs("div",{className:"p-2",children:[e.jsxs("div",{className:"mb-3 px-2",children:[e.jsxs("label",{className:"flex items-center justify-center gap-2 w-full px-3 py-2 bg-vs-accent/20 hover:bg-vs-accent/30 border border-vs-accent/50 rounded-lg cursor-pointer transition-colors",children:[e.jsx("svg",{className:"w-4 h-4 text-vs-accent",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),e.jsx("span",{className:"text-sm text-vs-accent font-medium",children:v?"Uploading...":"Upload Reference"}),e.jsx("input",{type:"file",accept:"image/*",onChange:z,disabled:v,className:"hidden"})]}),x&&e.jsx("p",{className:`mt-1 text-xs text-center ${x.startsWith("Error")?"text-red-400":"text-green-400"}`,children:x})]}),e.jsxs("div",{className:"mb-2 px-2 py-1 flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-white/40",children:d?`${d.totalFiles} files Â· ${d.totalSizeFormatted}`:"Loading..."}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>{fetch(`/api/projects/${o?.id}/open-folder`,{method:"POST"})},className:"p-1 hover:bg-white/10 rounded transition-colors",title:"Open folder in Explorer",children:e.jsx("svg",{className:"w-3.5 h-3.5 text-white/40 hover:text-white/70",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})}),e.jsx("button",{onClick:h,className:"p-1 hover:bg-white/10 rounded transition-colors",title:"Refresh files",children:e.jsx("svg",{className:"w-3.5 h-3.5 text-white/40 hover:text-white/70",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})]})]}),u.length>0?N(u):e.jsx("p",{className:"text-white/40 text-sm text-center py-4",children:"No files yet"}),o&&e.jsx("div",{className:"mt-3 pt-2 border-t border-white/10",children:e.jsxs("div",{className:"flex items-center gap-2 px-2",children:[e.jsxs("span",{className:"text-xs text-white/30 truncate flex-1 font-mono",title:`db/users/user_001/projects/${o.id}`,children:[".../",o.id]}),e.jsx("button",{onClick:()=>{const t=`C:\\Users\\yodes\\Documents\\n8n\\db\\users\\user_001\\projects\\${o.id}`;navigator.clipboard.writeText(t)},className:"p-1 hover:bg-white/10 rounded transition-colors",title:"Copy full path",children:e.jsx("svg",{className:"w-3 h-3 text-white/40 hover:text-white/70",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]})})]}):e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-white/70 mb-2",children:"Workflows Used"}),f.length>0?e.jsx("div",{className:"space-y-2",children:f.map(t=>e.jsxs("div",{className:"p-3 bg-white/5 rounded-lg border border-white/10",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-white/80 truncate",children:t.name}),e.jsxs("span",{className:"text-xs text-vs-accent bg-vs-accent/20 px-2 py-0.5 rounded",children:[t.count,"x"]})]}),e.jsxs("p",{className:"text-xs text-white/40 mt-1",children:["Last: ",B(t.lastRun)]})]},t.id))}):e.jsx("p",{className:"text-white/40 text-sm",children:"No workflows recorded"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-white/70 mb-2",children:"Recent Executions"}),j.length>0?e.jsx("div",{className:"space-y-1",children:j.slice(0,10).map(t=>e.jsxs("div",{className:"flex items-center gap-2 px-2 py-1.5 hover:bg-white/5 rounded",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${t.status==="success"?"bg-green-500":t.status==="error"?"bg-red-500":"bg-yellow-500"}`}),e.jsx("span",{className:"text-xs text-white/60 truncate flex-1",children:t.workflowName}),e.jsx("span",{className:"text-xs text-white/30",children:F(t.duration)})]},t.id))}):e.jsx("p",{className:"text-white/40 text-sm",children:"No executions recorded"})]})]})})]}):e.jsx("div",{className:"h-full flex items-center justify-center text-white/40",children:e.jsx("p",{children:"Select a project to view details"})})}export{R as default};
