import{a as M,g as W,R as V}from"./index.y5FlbPQu.js";const F={},L=t=>{let u;const r=new Set,s=(a,e)=>{const o=typeof a=="function"?a(u):a;if(!Object.is(o,u)){const c=u;u=e??(typeof o!="object"||o===null)?o:Object.assign({},u,o),r.forEach(i=>i(u,c))}},l=()=>u,m={setState:s,getState:l,getInitialState:()=>h,subscribe:a=>(r.add(a),()=>r.delete(a)),destroy:()=>{(F?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),r.clear()}},h=u=t(s,l,m);return m},q=t=>t?L(t):L;var _={exports:{}},I={},D={exports:{}},A={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var P;function O(){if(P)return A;P=1;var t=M();function u(e,o){return e===o&&(e!==0||1/e===1/o)||e!==e&&o!==o}var r=typeof Object.is=="function"?Object.is:u,s=t.useState,l=t.useEffect,d=t.useLayoutEffect,v=t.useDebugValue;function g(e,o){var c=o(),i=s({inst:{value:c,getSnapshot:o}}),p=i[0].inst,S=i[1];return d(function(){p.value=c,p.getSnapshot=o,m(p)&&S({inst:p})},[e,c,o]),l(function(){return m(p)&&S({inst:p}),e(function(){m(p)&&S({inst:p})})},[e]),v(c),c}function m(e){var o=e.getSnapshot;e=e.value;try{var c=o();return!r(e,c)}catch{return!0}}function h(e,o){return o()}var a=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?h:g;return A.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:a,A}var R;function z(){return R||(R=1,D.exports=O()),D.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var k;function N(){if(k)return I;k=1;var t=M(),u=z();function r(h,a){return h===a&&(h!==0||1/h===1/a)||h!==h&&a!==a}var s=typeof Object.is=="function"?Object.is:r,l=u.useSyncExternalStore,d=t.useRef,v=t.useEffect,g=t.useMemo,m=t.useDebugValue;return I.useSyncExternalStoreWithSelector=function(h,a,e,o,c){var i=d(null);if(i.current===null){var p={hasValue:!1,value:null};i.current=p}else p=i.current;i=g(function(){function b(w){if(!n){if(n=!0,f=w,w=o(w),c!==void 0&&p.hasValue){var j=p.value;if(c(j,w))return y=j}return y=w}if(j=y,s(f,w))return j;var x=o(w);return c!==void 0&&c(j,x)?(f=w,j):(f=w,y=x)}var n=!1,f,y,E=e===void 0?null:e;return[function(){return b(a())},E===null?void 0:function(){return b(E())}]},[a,e,o,c]);var S=l(h,i[0],i[1]);return v(function(){p.hasValue=!0,p.value=S},[S]),m(S),S},I}var C;function G(){return C||(C=1,_.exports=N()),_.exports}var J=G();const B=W(J),T={},{useDebugValue:H}=V,{useSyncExternalStoreWithSelector:K}=B;let U=!1;const Q=t=>t;function X(t,u=Q,r){(T?"production":void 0)!=="production"&&r&&!U&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),U=!0);const s=K(t.subscribe,t.getState,t.getServerState||t.getInitialState,u,r);return H(s),s}const $=t=>{(T?"production":void 0)!=="production"&&typeof t!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const u=typeof t=="function"?q(t):t,r=(s,l)=>X(u,s,l);return Object.assign(r,u),r},Y=t=>t?$(t):$,Z=[{id:"movieagent-standalone",name:"MovieAgent (Story to Shots)",endpoint:"/webhook/movieagent-standalone/chat"},{id:"visual-intake",name:"Story Intake (New!)",endpoint:"/webhook/visual-story-intake/chat"},{id:"visual-story",name:"Visual Story Agent",endpoint:"/webhook/visual-story-agent/chat"},{id:"universal-v5",name:"Universal v5 (Memory)",endpoint:"/webhook/universal-v5/chat"},{id:"chip-agent-v2",name:"CHIP Agent v2",endpoint:"/webhook/chip-agent-v2/chat"},{id:"universal-agent",name:"Universal Agent",endpoint:"/webhook/test-universal/chat"}],te=Y((t,u)=>({messages:[],isLoading:!1,error:null,chatSessionId:null,currentAgent:Z[0],activeProject:null,projects:[],projectsLoading:!1,sendMessage:async(r,s)=>{const{chatSessionId:l,messages:d,currentAgent:v,activeProject:g}=u(),m=g?.id||l||`${s}_${Date.now()}`;l||t({chatSessionId:m});const h={id:`msg_${Date.now()}`,role:"user",content:r,timestamp:new Date};t({messages:[...d,h],isLoading:!0,error:null});try{const a=await fetch("/api/chat/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chatInput:r,chatSessionId:m,projectId:g?.id,agentEndpoint:v.endpoint})});if(!a.ok){const n=await a.json();throw new Error(n.error||"Failed to send message")}const e=await a.json();let o=e.response||e.output||"";typeof o=="object"&&(o=JSON.stringify(o,null,2));const c=n=>{if(!n)return"";if(n.startsWith("http://")||n.startsWith("https://"))return n;const f=n.match(/db\\\\users\\\\(.+)/)||n.match(/db\/users\/(.+)/);return f?"/api/files/"+f[1].replace(/\\\\/g,"/").replace(/\\/g,"/"):n},i=[];if(e.media&&Array.isArray(e.media))for(const n of e.media)i.push({type:n.type||"image",url:c(n.url||n.path||n.localPath)});if((e.imageUrl||e.image_url)&&i.push({type:"image",url:c(e.imageUrl||e.image_url)}),(e.videoUrl||e.video_url)&&i.push({type:"video",url:c(e.videoUrl||e.video_url)}),e.localPath||e.local_path){const n=e.localPath||e.local_path,f=n.split(".").pop()?.toLowerCase(),y=["mp4","webm","mov"].includes(f)?"video":"image";i.push({type:y,url:c(n)})}if(e.urls&&(e.urls.image&&i.push({type:"image",url:c(e.urls.image)}),e.urls.video&&i.push({type:"video",url:c(e.urls.video)}),e.urls.all&&Array.isArray(e.urls.all))){for(const n of e.urls.all)if(!i.some(f=>f.url===n)){const f=n.split(".").pop()?.toLowerCase()||"",y=["mp4","webm","mov"].includes(f)?"video":"image";i.push({type:y,url:c(n)})}}const p=/https?:\/\/[^\s<>"{}|\\^`\[\]]+\.(png|jpg|jpeg|gif|webp|mp4|webm|mov)/gi,S=o.match(p)||[];for(const n of S){const f=n.split(".").pop()?.toLowerCase()||"",y=["mp4","webm","mov"].includes(f)?"video":"image";i.some(E=>E.url===n)||i.push({type:y,url:n})}const b={id:`msg_${Date.now()}_resp`,role:"assistant",content:o||"Done!",timestamp:new Date,media:i.length>0?i:void 0};t(n=>({messages:[...n.messages,b],isLoading:!1}))}catch(a){t({isLoading:!1,error:a instanceof Error?a.message:"Unknown error"});const e={id:`msg_${Date.now()}_err`,role:"assistant",content:`Error: ${a instanceof Error?a.message:"Failed to send message"}`,timestamp:new Date};t(o=>({messages:[...o.messages,e]}))}},clearMessages:()=>t({messages:[],chatSessionId:null,error:null}),setSessionId:r=>t({chatSessionId:r}),setAgent:r=>t({currentAgent:r,messages:[],chatSessionId:null,error:null}),fetchProjects:async()=>{t({projectsLoading:!0});try{const r=await fetch("/api/projects");if(r.ok){const s=await r.json();t({projects:s.projects||[],projectsLoading:!1})}else t({projectsLoading:!1})}catch(r){console.error("Failed to fetch projects:",r),t({projectsLoading:!1})}},createProject:async r=>{try{const s=await fetch("/api/projects",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:r})});if(s.ok){const l=await s.json(),d={id:l.projectId,name:l.name,thumbnail:null,modified:new Date().toISOString(),outputCount:0};return t(v=>({projects:[d,...v.projects],activeProject:d,chatSessionId:l.projectId,messages:[],error:null})),l.projectId}return null}catch(s){return console.error("Failed to create project:",s),null}},selectProject:async r=>{try{const s=await fetch(`/api/projects/${r}`);if(s.ok){const d=(await s.json()).project,v=(d.messages||[]).map((g,m)=>({id:`loaded_${m}_${Date.now()}`,role:g.role,content:g.content,timestamp:new Date(g.timestamp),media:g.media}));t({activeProject:{id:d.id,name:d.name,thumbnail:d.thumbnail,modified:d.modified,outputCount:d.outputCount},chatSessionId:d.id,messages:v,error:null})}}catch(s){console.error("Failed to select project:",s)}},clearProject:()=>t({activeProject:null,chatSessionId:null,messages:[],error:null})}));export{Z as A,te as u};
